<!DOCTYPE html>
<html>
<head>
	{% import "bootstrap/wtf.html" as wtf %}
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Home</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<!-- Bootstrap CSS-->
<link rel="stylesheet" href="../static/vendor/bootstrap/css/bootstrap.min.css">
<!-- Google fonts-->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cardo:400,400i">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
<!-- Lightbox-->
<link rel="stylesheet" href="../static/vendor/lightbox2/css/lightbox.min.css">
<!-- Font Awesome-->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
<!-- Parallax-->
<link rel="stylesheet" href="../static/vendor/onepage-scroll/onepage-scroll.css">
<!-- theme stylesheet-->
<link rel="stylesheet" href="../static/css/style.sea.css" id="theme-stylesheet">
<!-- Custom stylesheet - for your changes-->
<link rel="stylesheet" href="../static/css/custom.css">
<!-- Favicon-->
<link rel="shortcut icon" href="favicon.png">
<!-- Tweaks for older IEs--><!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
    <style>

        #head1, #head2, #head3, #head4{
            position:absolute;
            top:2%;
            left:36%;
            z-index:10;
        }
        .container1, .container2, .container3, .container4{
            position:absolute;
            left:2%;
            top:2%;
            z-index:1;
        }
        @font-face{
					font-family:yanti;
					src:url('../static/书体坊颜体.ttf');
                }
        @font-face{
					font-family:zhao;
					src:url('../static/书体坊赵九江钢笔楷书.ttf');
                }
        .bk{
        	position:absolute;
        	top:10%;
        	height:80%;
        	width:100%;
        	border-top:5px solid rgb(230,130,80);
        	border-right:20px solid rgb(230,130,80);
        	border-bottom:5px solid rgb(230,130,80);
        	border-left:20px solid rgb(230,130,80);
			z-index:-10;
        }
        .title{
        	position:absolute;
        	right:0%;
        	top:10%;
        	width:20%;
        	height:80%;
        	background:rgb(230,130,80);
        	z-index:10;
        }
        .title #clothing img{
        	position:absolute;
        	right:0%;
        	top:0%;
        	width:100%;
        	height:80%;
        }
        .title #badge img{
        	position:absolute;
        	right:60%;
        	top:80%;
        	width:40%;
        	height:20%;
        }
        .title #num{
        	position:absolute;
        	right:0%;
        	top:80%;
        	width:60%;
        	height:20%;
        }
        .province {
			stroke: black;
			stroke-width: 1px;
		}

		.southchinasea {
			stroke: black;
			stroke-width: 1px;
			fill: red;
		}
		.page-header h1{
    		font-family:yanti;
    		color:#f3c209;
    	}
    	.form{
    		font-size:30px;
    		color:#705415;
    		font-family:zhao
    	}
    	.form input{
    		font-size:20px;
    		color:white;
    	}
    </style>
</head>
<body>
<div class="main">
  <section class="bg-cover bg-center hero">
	<div class="dark-overlay"></div>
	<div class="position-relative z-index-1">
	  <div class="container text-center text-white">
		<h1 class="text-uppercase my-4">中国各民族各项数据统计分析</h1>
		<p class="font-italic lead">数据来源：教育部 国家统计局</p>
	  </div>
		<div class="page-header">
			<h1> {% if name %}{{ name }}<br>{{wordc}} {% else %}56个民族是一家{% endif %}!</h1>
		</div>
		<!--使用wtf.quick_form把form表单快速渲染成表单样式-->
		{{ wtf.quick_form(form) }}
	</div>
	<div class="scroll-btn link-scroll"><i class="fas fa-angle-double-down"></i></div>
  </section>
  <section id="1">
	<div class="d-flex h-100 align-items-center">

		  <header class="text-center mb-0" id="head1">
		  <h2 class="text-uppercase lined">少数民族人数统计</h2>
		</header>
		  <div class="container1"></div>
			<div class="bk"></div>
			<div class="title">
				<div id="clothing"></div>
				<div id="badge"></div>
				<div id="num"></div>
			</div>
	</div>
  </section>
  <section class="bg-gray">
		<header class="text-center mb-0" id="head2">
		  <h2 class="text-uppercase lined">少数民族教职工及学生占比</h2>
		</header>
		  <div class="container2"></div>
  </section>
  <section>
	<div class="d-flex h-100 align-items-center">

		<header class="text-center mb-0" id="head3">
		  <h2 class="text-uppercase lined">少数民族分布</h2>
		</header>
		<div class="container3"></div>

	</div>
  </section>
	<section class="bg-gray">
	<div class="d-flex h-100 align-items-center">

		<header class="text-center mb-0" id="head4">
		  <h2 class="text-uppercase lined">各城市省份少数民族人数</h2>
		</header>
        <div class="container4"></div>

	</div>
  </section>
  <section>
	<div class="d-flex h-100 align-items-center">
	  <div class="container">
		<header class="text-center mb-5">
		  <h2 class="text-uppercase lined">民族风情</h2>
		</header>
		<div class="row">
		  <div class="col-lg-12 text-center">
			<p>点击图片查看详情</p>
		  </div>
		  <div class="col-lg-4 col-md-6 mb-4"><a href="../static/img/portfolio-1.jpg" data-lightbox="image-1" data-title="My caption" class="d-block mb-1"><img src="../static/img/portfolio-1.jpg" alt="..." class="img-fluid d-block mx-auto"></a></div>
		  <div class="col-lg-4 col-md-6 mb-4"><a href="../static/img/portfolio-2.jpg" data-lightbox="image-1" data-title="My caption" class="d-block mb-1"><img src="../static/img/portfolio-2.jpg" alt="..." class="img-fluid d-block mx-auto"></a></div>
		  <div class="col-lg-4 col-md-6 mb-4"><a href="../static/img/portfolio-3.jpg" data-lightbox="image-1" data-title="My caption" class="d-block mb-1"><img src="../static/img/portfolio-3.jpg" alt="..." class="img-fluid d-block mx-auto"></a></div>
		  <div class="col-lg-4 col-md-6 mb-4"><a href="../static/img/portfolio-4.jpg" data-lightbox="image-1" data-title="My caption" class="d-block mb-1"><img src="../static/img/portfolio-4.jpg" alt="..." class="img-fluid d-block mx-auto"></a></div>
		  <div class="col-lg-4 col-md-6 mb-4"><a href="../static/img/portfolio-5.jpg" data-lightbox="image-1" data-title="My caption" class="d-block mb-1"><img src="../static/img/portfolio-5.jpg" alt="..." class="img-fluid d-block mx-auto"></a></div>
		  <div class="col-lg-4 col-md-6 mb-4"><a href="../static/img/portfolio-6.jpg" data-lightbox="image-1" data-title="My caption" class="d-block mb-1"><img src="../static/img/portfolio-6.jpg" alt="..." class="img-fluid d-block mx-auto"></a></div>
		</div>
	  </div>
	</div>
  </section>
</div>
<!-- JavaScript files-->
<script src="../static/vendor/jquery/jquery.min.js"></script>
<script src="../static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../static/vendor/onepage-scroll/jquery.onepage-scroll.min.js"></script>
<script src="../static/vendor/lightbox2/js/lightbox.min.js"></script>
<script src="../static/js/front.js"></script>
<!-- FontAwesome CSS - loading as last, so it doesn't block rendering-->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">
<script src="../static/d3.v3.min.js" charset="utf-8"></script>
<script src="../static/d3.layout.cloud.js"></script>
	<script>
		var width=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)*0.96;
		var height=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)*0.98;
		var color = d3.scale.category20();
		//词云图
            var words=[
                        {'text':'蒙古族','size':5981840,'clothing':7},
                        {'text':'回族','size':10586087,'clothing':8},
                        {'text':'藏族','size':6282187,'clothing':22},
                        {'text':'维吾尔族','size':10069346,'clothing':20},
                        {'text':'苗族','size':9426007,'clothing':48},
                        {'text':'彝族','size':8714393,'clothing':26},
                        {'text':'壮族','size':16926381,'clothing':44},
                        {'text':'布依族','size':2870034,'clothing':50},
                        {'text':'朝鲜族','size':1830929,'clothing':2},
                        {'text':'满族','size':10387958,'clothing':1},
                        {'text':'侗族','size':2879974,'clothing':47},
                        {'text':'瑶族','size':2796003,'clothing':46},
                        {'text':'白族','size':1933510,'clothing':28},
                        {'text':'土家族','size':8353912,'clothing':53},
                        {'text':'哈尼族','size':1660932,'clothing':40},
                        {'text':'哈萨克族','size':1462588,'clothing':18},
                        {'text':'傣族','size':1261311,'clothing':38},
                        {'text':'黎族','size':1463064,'clothing':42},
                        {'text':'傈僳族','size':702839,'clothing':29},
                        {'text':'佤族','size':429709,'clothing':35},
                        {'text':'畲族','size':708651,'clothing':54},
                        {'text':'高山族','size':4009,'clothing':55},
                        {'text':'拉祜族','size':485966,'clothing':36},
                        {'text':'水族','size':411847,'clothing':49},
                        {'text':'东乡族','size':621500,'clothing':9},
                        {'text':'纳西族','size':326295,'clothing':25},
                        {'text':'景颇族','size':147828,'clothing':32},
                        {'text':'柯尔克孜族','size':186708,'clothing':19},
                        {'text':'土族','size':289565,'clothing':12},
                        {'text':'达斡尔族','size':131992,'clothing':4},
                        {'text':'仫佬族','size':216257,'clothing':45},
                        {'text':'羌族','size':309576,'clothing':52},
                        {'text':'布朗族','size':119639,'clothing':37},
                        {'text':'撒拉族','size':130607,'clothing':11},
                        {'text':'毛南族','size':101192,'clothing':43},
                        {'text':'仡佬族','size':550746,'clothing':51},
                        {'text':'锡伯族','size':190481,'clothing':17},
                        {'text':'阿昌族','size':395505,'clothing':33},
                        {'text':'普米族','size':42861,'clothing':27},
                        {'text':'塔吉克族','size':51069,'clothing':21},
                        {'text':'怒族','size':37523,'clothing':30},
                        {'text':'乌孜别克族','size':10569,'clothing':15},
                        {'text':'俄罗斯族','size':15393,'clothing':14},
                        {'text':'鄂温克族','size':30875,'clothing':6},
                        {'text':'德昂族','size':20556,'clothing':34},
                        {'text':'保安族','size':20074,'clothing':10},
                        {'text':'裕固族','size':14378,'clothing':13},
                        {'text':'京族','size':28199,'clothing':41},
                        {'text':'塔塔尔族','size':3556,'clothing':16},
                        {'text':'独龙族','size':6930,'clothing':31},
                        {'text':'鄂伦春族','size':8659,'clothing':5},
                        {'text':'赫哲族','size':5354,'clothing':3},
                        {'text':'门巴族','size':10561,'clothing':24},
                        {'text':'珞巴族','size':3682,'clothing':23},
                        {'text':'基诺族','size':23143,'clothing':39}];
            var wc=d3.layout.cloud()
				  .size([width, height])
				  .words(words)
				  .padding(5)
				  .rotate(function() { return ~~(Math.random() * 2) * 90; })
				  .font("yanti")
				  .fontSize(function(d) { return d.size/110000; })
				  .on("end", draw)
				  .start();

		    function draw(words) {
			d3.select("div.container1").append("svg")
				.attr("width", width)
                .attr("height", height)
			    .append("g")
				.attr("transform", "translate(650,350)")
			    .selectAll("text")
				.data(words)
			    .enter().append("text")
				.style("font-size", function(d) { return d.size + "px"; })
				.style("font-family", "yanti")
				.style("fill", function(d, i) { return "rgba(230,130,80,"+(1-(d.size/13000000)+0.2) +")"; })
				.attr("text-anchor", "middle")
				.attr("transform", function(d) {
				  return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
				})
                .text(function(d) { return d.text; })
                .on("mouseover",function(d,i){
                    d3.select(this).style("text-shadow", "0px 0px 10px #8a350a")
                                    .style("font-size",function(d){return (d.size+14)+"px";})

                					document.getElementById('clothing').innerHTML = "<img src='../static/clothing/"+d.clothing+".jpg'/>";
									document.getElementById('badge').innerHTML = "<img src='../static/badge/"+d.clothing+".jpg'/>";
                					document.getElementById('num').innerHTML = "<font style='color:black;font-family:yanti;font-size:40px;'>"+d.text+" <br />"+d.size+"%</font>";

                })
                .on("mouseout",function(){
                    d3.select(this).style("text-shadow", "0px 0px 0px #8a350a")
                                    .style("font-size",function(d){return d.size+"px";})
                })

            }

		//直方图
		var dataset0 =["学前教育","特殊教育","初等教育","初中阶段教育","高中阶段教育","其他高等教育","成人高等教育","普通高等教育","研究生教育"];
		var dataset1 =[7.24,8.48,10.90,9.20,7.5,0.75,5.31,5.92,0];
		var dataset2 =[10.53,10.16,11.65,11.30,10.47,7.04,9.11,9.04,4.85];

		var svg1 = d3.select("div.container2")			//选择<body>
					.append("svg")			//在<body>中添加<svg>
					.attr("width", width)	//设定<svg>的宽度属性
					.attr("height", height);//设定<svg>的高度属性
		//左侧空出空间
		var space = 100;
		//矩形所占的宽度（包括空白），单位为像素
		var rectStep =(width-space)/dataset1.length;
		//矩形所占的宽度（不包括空白），单位为像素
		var rectWidth =rectStep-width*0.04;
		var rect1 = svg1.selectAll("rect1")
						.data(dataset1)		//绑定数据
						.enter()			//获取enter部分
						.append("rect")	    //添加rect元素，使其与绑定数组的长度一致
						.attr("x", function(d,i){		//设置矩形的x坐标
							return i * rectStep+space;
						})

						.attr("fill", function(i){
							return color(i);
						})
						.attr("width",rectWidth)		//设置矩形的宽度

						.attr("height",function(d){	//设置矩形的高度
							return d*20;
						})
						.attr("y", function(d){		//设置矩形的y坐标
							return height*0.5-d*20-25;
						})
						.on("mouseover",function(d,i){
						    d3.select(this)
							.attr("fill","yellow");

							var index=i;
							rect2.filter(function(d,i){
							    return i==index;
						    }).attr("fill","yellow")
						})
						.on("mouseout",function(d,i){
							d3.select(this)
							  .transition()
							  .duration(500)
							  .attr("fill",function(i){
							        return color(i);
						        });

						    var index=i;
							rect2.filter(function(d,i){
							    return i==index;
						    }).attr("fill",function(i){
							        return color(i);
						        });
						});


		var rect2 = svg1.selectAll("rect2")
						.data(dataset2)		//绑定数据
						.enter()			//获取enter部分
						.append("rect")	    //添加rect元素，使其与绑定数组的长度一致
						.attr("x", function(d,i){		//设置矩形的x坐标
							return i * rectStep + space;
						})

						.attr("fill", function(i){
							return color(i);
						})
						.attr("width",rectWidth)		//设置矩形的宽度
						.attr("height",function(d){	//设置矩形的高度
							return d*20;
						})
						.attr("y", function(d){		//设置矩形的y坐标
							return height*0.5;
						})
						.on("mouseover",function(d,i){
						    d3.select(this)
							.attr("fill","yellow");

							var index=i;
							rect1.filter(function(d,i){
							    return i==index;
						    }).attr("fill","yellow")
						})
						.on("mouseout",function(d,i){
							d3.select(this)
							  .transition()
							  .duration(500)
							  .attr("fill",function(i){
							        return color(i);
						        });

						    var index=i;
							rect1.filter(function(d,i){
							    return i==index;
						    }).attr("fill",function(i){
							        return color(i);
						        });
						});
        var text0 = svg1.selectAll("text0")
				    .data(dataset0)			//绑定数据
				    .enter()				//获取enter部分
				    .append("text")			//添加text元素，使其与绑定数组的长度一致
				    .attr("fill","green")
				    .attr("font-size","20px")
				    .attr("text-anchor","middle")
				    .attr("x", function(d,i){
					    return i * rectStep+space;
				    })
				    .attr("y", function(d){
					    return height*0.5-25;
				    })
				    .attr("dx",rectWidth/2)
				    .attr("dy","1em")
				    .text(function(d){
					    return d;
				    });
		var text1 = svg1.selectAll("text1")
				    .data(dataset1)			//绑定数据
				    .enter()				//获取enter部分
				    .append("text")			//添加text元素，使其与绑定数组的长度一致
				    .attr("fill","green")
				    .attr("font-size","20px")
				    .attr("text-anchor","middle")
				    .attr("x", function(d,i){
				    	return i * rectStep+space;
				    })
				    .attr("y", function(d){
				    	return height*0.5-d*20-50;
				    })
				    .attr("dx",rectWidth/2)
				    .attr("dy","1em")
				    .text(function(d){
				    	return d+"%";
				    });
        var text2 = svg1.selectAll("text2")
				    .data(dataset2)			//绑定数据
				    .enter()				//获取enter部分
				    .append("text")			//添加text元素，使其与绑定数组的长度一致
				    .attr("fill","green")
				    .attr("font-size","20px")
				    .attr("text-anchor","middle")
				    .attr("x", function(d,i){
				    	return i * rectStep+space;
				    })
				    .attr("y", function(d){
				    	return height*0.5+d*20;
				    })
				    .attr("dx",rectWidth/2)
				    .attr("dy","1em")
				    .text(function(d){
				    	return d+"%";
				    });
        var text3 = svg1.append("text")
                        .attr("fill","green")
				        .attr("font-size","20px")
				        .attr("x","0px")
				        .attr("y", height*0.5-50)
				        //.attr("dx",10)
				        //.attr("dy","1em")
				        .text("少数民族");
		var text4 = svg1.append("text")
                        .attr("fill","green")
				        .attr("font-size","20px")
				        .attr("x","0px")
				        .attr("y", height*0.5-25)
				        //.attr("dx",10)
				        //.attr("dy","1em")
				        .text("教职工：");
	    var text5 = svg1.append("text")
                        .attr("fill","green")
				        .attr("font-size","20px")
				        .attr("x","0px")
				        .attr("y", height*0.5+25)
				        //.attr("dx",10)
				        //.attr("dy","1em")
				        .text("少数民族");
		var text6 = svg1.append("text")
                        .attr("fill","green")
				        .attr("font-size","20px")
				        .attr("x","0px")
				        .attr("y", height*0.5+50)
				        //.attr("dx",10)
				        //.attr("dy","1em")
				        .text("学生：");
		//地图
		var num = [11,0,18,0,0,2,507,142,51,0,0,1,2,55,57,56,65,252,0,122,302,1,151,4,315,319,7,470,0,0,0,0,0,0];
			var linear = d3.scale.linear()
						.domain([990,90000])
						.range([0,255]);

			//创建颜色插值函数
			var maxvalue = d3.max(num);
	   		var minvalue = 0;

	    	var linear = d3.scale.linear()
	    			   .domain([minvalue,maxvalue])
	    			   .range([0,1]);


			var a = d3.rgb(147,181,207);   //浅色
			var b = d3.rgb(20,74,116);  //深色
			//颜色插值函数
			var computeColor = d3.interpolate(a,b);

			// var mapcolor = new Array();
			// for(var i=0; i<34; i++){
			// 	mapcolor[i] = "#"+parseInt(255-linear(gdp[i])).toString(16)+"0000";
			// }
			// console.log(mapcolor);

			var svg3 = d3.select("div.container3").append("svg")
						.attr("width", width)
						.attr("height", height);

			//定义地图的投影
			var projection = d3.geo.mercator()
								   .center([107, 31])
								   .scale(550)
								   .translate([width/2, height/2]);

			//定义地形路径生成器
			var path = d3.geo.path()
						 .projection(projection);	//设定投影

			//请求china.geojson
			d3.json("../static/China.json", function(error, root) {
				if (error)
					return console.error(error);
				console.log(root);

                //实现图表的缩放
                var zoom = d3.behavior.zoom()
                                        .scaleExtent([1,5])   //设置最大缩放比例
                                        .on("zoom",zoomed);

                            function zoomed(){
                                d3.select(this)
                                .attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")");
                            }

                var groups = svg3.append("g")
                                .call(zoom);

				groups.selectAll("path")
						.data(root.features)
						.enter()
						.append("path")
						.attr("class","province")
						.attr("fill", function(d,i){
							//return mapcolor[i];
							var t = linear(num[i]);
							var color = computeColor(t);
	    		  			return color.toString();
						})
						.attr("d", path)	//使用路径生成器
						.on("mouseover",function(d,i){
							d3.select(this)
								.attr("fill","#8a350a");
						})
						.on("mouseout",function(d,i){
							d3.select(this)
							.attr("fill",function(d){//mapcolor[i]);
								console.log(i);
								var t = linear(num[i]);
								var color = computeColor(t);
								return color.toString();
	    		  		})
						});
			    var texts = svg3.selectAll(".texts")
								.data(root.features)
								.enter()
								.append("text")
								.attr("class", "texts")
								.text(function(d){return d.properties.name;})
								.attr("transform", function(d) {
									var centroid = path.centroid(d),
										x = centroid[0],
										y = centroid[1];
								    if((d.properties.name=="河北")||(d.properties.name=="澳门")||(d.properties.name=="安徽"))
											y=y+25;
									return "translate(" + x + ", " + y + ")";
								})
								.attr('fill','#332828')
								.attr("font-size","12px");
			});
			//请求southchinasea.svg
			d3.xml("../static/southchinasea.svg", function(error, xmlDocument) {
				svg3.html(function(d){
					return d3.select(this).html() + xmlDocument.getElementsByTagName("g")[0].outerHTML;
				});
				d3.select("#southchinasea")
					.attr("transform","translate(840,380)scale(0.5)")
					.attr("class","southchinasea");
			});
        //气泡图
        var svg4=d3.select("div.container4")
                .append("svg")
                .attr("width",width)
                .attr("height",height);
	    var nodes=[
	    {name:"{{ li[1][0] }}",total:{{ li[1][1] }},han:{{ li[1][2] }} },
	    {name:"{{ li[2][0] }}",total:{{ li[2][1] }},han:{{ li[2][2] }} },
	    {name:"{{ li[3][0] }}",total:{{ li[3][1] }},han:{{ li[3][2] }} },
	    {name:"{{ li[4][0] }}",total:{{ li[4][1] }},han:{{ li[4][2] }} },
	    {name:"{{ li[5][0] }}",total:{{ li[5][1] }},han:{{ li[5][2] }} },
	    {name:"{{ li[6][0] }}",total:{{ li[6][1] }},han:{{ li[6][2] }} },
	    {name:"{{ li[7][0] }}",total:{{ li[7][1] }},han:{{ li[7][2] }} },
	    {name:"{{ li[8][0] }}",total:{{ li[8][1] }},han:{{ li[8][2] }} },
	    {name:"{{ li[9][0] }}",total:{{ li[9][1] }},han:{{ li[9][2] }} },
	    {name:"{{ li[10][0] }}",total:{{ li[10][1] }},han:{{ li[10][2] }} },
	    {name:"{{ li[11][0] }}",total:{{ li[11][1] }},han:{{ li[11][2] }} },
	    {name:"{{ li[12][0] }}",total:{{ li[12][1] }},han:{{ li[12][2] }} },
	    {name:"{{ li[13][0] }}",total:{{ li[13][1] }},han:{{ li[13][2] }} },
	    {name:"{{ li[14][0] }}",total:{{ li[14][1] }},han:{{ li[14][2] }} },
	    {name:"{{ li[15][0] }}",total:{{ li[15][1] }},han:{{ li[15][2] }} },
	    {name:"{{ li[16][0] }}",total:{{ li[16][1] }},han:{{ li[16][2] }} },
	    {name:"{{ li[17][0] }}",total:{{ li[17][1] }},han:{{ li[17][2] }} },
	    {name:"{{ li[18][0] }}",total:{{ li[18][1] }},han:{{ li[18][2] }} },
	    {name:"{{ li[19][0] }}",total:{{ li[19][1] }},han:{{ li[19][2] }} },
	    {name:"{{ li[20][0] }}",total:{{ li[20][1] }},han:{{ li[20][2] }} },
	    {name:"{{ li[21][0] }}",total:{{ li[21][1] }},han:{{ li[21][2] }} },
	    {name:"{{ li[22][0] }}",total:{{ li[22][1] }},han:{{ li[22][2] }} },
	    {name:"{{ li[23][0] }}",total:{{ li[23][1] }},han:{{ li[23][2] }} },
	    {name:"{{ li[24][0] }}",total:{{ li[24][1] }},han:{{ li[24][2] }} },
	    {name:"{{ li[25][0] }}",total:{{ li[25][1] }},han:{{ li[25][2] }} },
	    {name:"{{ li[26][0] }}",total:{{ li[26][1] }},han:{{ li[26][2] }} },
	    {name:"{{ li[27][0] }}",total:{{ li[27][1] }},han:{{ li[27][2] }} },
	    {name:"{{ li[28][0] }}",total:{{ li[28][1] }},han:{{ li[28][2] }} },
	    {name:"{{ li[29][0] }}",total:{{ li[29][1] }},han:{{ li[29][2] }} },
	    {name:"{{ li[30][0] }}",total:{{ li[30][1] }},han:{{ li[30][2] }} },
	    {name:"{{ li[31][0] }}",total:{{ li[31][1] }},han:{{ li[31][2] }} },
	    //民族
	    {name:"维吾尔族",total:10001302,han:0},//31
	    {name:"哈萨克族",total:1418278,han:0},
	    {name:"柯尔克孜族",total:180472,han:0},
	    {name:"壮族",total:14448422,han:0},
	    {name:"瑶族",total:1493530,han:0},
	    {name:"苗族",total:475492,han:0},
	    {name:"彝族",total:5041210,han:0},
	    {name:"壮族",total:1215260,han:0},
	    {name:"苗族",total:1202705,han:0}
	    ];
	    var edges=[{source:30,target:31},{source:30,target:32},{source:30,target:33},
	    			{source:19,target:34},{source:19,target:35},{source:19,target:36},
	    			{source:24,target:37},{source:24,target:38},{source:24,target:39}
	    ];
	    var force=d3.layout.force()
                .nodes(nodes)
				.links(edges)
				.size([width,height])
				.linkDistance(150)
				.charge(-600)
                .start();
		//绘制
		var color=d3.scale.category20();
		var lines=svg4.selectAll(".forceLine")
	             .data(edges)
				 .enter()
          	     .append("line")
				 .attr("class","forceLine")
				 .style("stroke","gray")
				 .style("opacity",0.0)
                 .style("stroke-width",1);

		var circles=svg4.selectAll("forceCircle")
	               .data(nodes)
				   .enter()
				   .append("circle")
				   .attr("class","forceCircle")
				   .attr("r",function(d,i){if(i>=0 && i<=30)return (d.total-d.han)*0.00001;else return ((d.total-d.han)*0.00001+20);})
				   .attr("fill",function(d,i){return color(i);})
				   .attr("opacity",function(d,i){if(i>=1&&i<=30)return 1;else return 0;})
				   .on("mouseover",function(d,i){
				   if(i>=1&&i<=30){
				        //悬停时让其他节点透明
						var index = i;
						circles.filter(function(d,i){
							return i!=index;
						}).attr("opacity",0.2);
						texts.filter(function(d,i){
							return i!=index;
						}).attr("opacity",0);
                        texts2.filter(function(d,i){
							return i!=index;
						}).attr("opacity",0);
						//自己节点变小
						//d3.select(this)
						//    .attr("r",r*0.8);

						edges.filter(function(d_,i){
							if(d_.source.index==index){
									circles.filter(function(d,i){
										return i==d_.target.index;
									}).attr("opacity",1)
								        .attr("r",d.total*0.000002+20);
									texts.filter(function(d,i){

										return i==d_.target.index;
									}).attr("opacity",1)
									    .style("font-size",20);
									texts2.filter(function(d,i){

										return i==d_.target.index;
									}).attr("opacity",1)
									    .style("font-size",20);
							}
						})
						}
				   })
				   .on("mouseout",function(d,i){
				   if(i>=1&&i<=30){
				        circles.attr("opacity",function(d,i){if(i>=1&&i<=30)return 1;else return 0;})
						texts.attr("opacity",function(d,i){if(i>=1&&i<=30)return 1;else return 0;});
						texts2.attr("opacity",function(d,i){if(i>=1&&i<=30)return 1;else return 0;});
				   }
				   })
				   .call(force.drag);
	    var texts=svg4.selectAll(".forceText")
                 .data(nodes)
				 .enter()
				 .append("text")
				 .attr("class","forceText")
				 .attr("x",function(d){return d.x;})
				 .attr("y",function(d){return d.y;})
				 .style("font-family","yanti")
				 .style("font-size",function(d){if((d.total-d.han)*0.000006>10) return ((d.total-d.han)*0.000006);else return 10;})
                 .attr("text-anchor","middle")
                 .attr("dx","-0em")
				 .attr("dy","0em")
				 .attr("opacity",function(d,i){if(i>=1&&i<=30)return 1;else return 0;})
				 .text(function(d,i){return d.name;});
        var texts2=svg4.selectAll(".forceText2")
                 .data(nodes)
				 .enter()
				 .append("text")
				 .attr("class","forceText2")
				 .attr("x",function(d){return d.x;})
				 .attr("y",function(d){return d.y;})
				 .style("font-family","yanti")
				 .style("font-size",function(d){if((d.total-d.han)*0.00003>10) return ((d.total-d.han)*0.000003);else return 10;})
                 .attr("text-anchor","middle")
                 .attr("dx","-0em")
				 .attr("dy","1em")
				 .attr("opacity",function(d,i){if(i>=1&&i<=30)return 1;else return 0;})
				 .text(function(d,i){return (d.total-d.han)+"人";});
		force.on("tick",function(){
	          lines.attr("x1",function(d){return d.source.x;});
              lines.attr("y1",function(d){return d.source.y;});
              lines.attr("x2",function(d){return d.target.x;});
              lines.attr("y2",function(d){return d.target.y;});
			  circles.attr("cx",function(d){return d.x;});
			  circles.attr("cy",function(d){return d.y;});
			  texts.attr("x",function(d){return d.x;});
			  texts.attr("y",function(d){return d.y;});
			  texts2.attr("x",function(d){return d.x;});
			  texts2.attr("y",function(d){return d.y;});
		});

	</script>
</body>
</html>